<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 5 Grammar Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            background: #f8f9fa;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.2);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .grammar-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .grammar-box h3 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .grammar-box ul {
            list-style: none;
            padding-left: 0;
        }

        .grammar-box li {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .example {
            background: #fff9e6;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }

        .question {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .question:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        .question-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .question-text {
            flex: 1;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .input-container {
            margin: 15px 0;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input[type="text"].correct {
            border-color: #4caf50;
            background: #f1f8e9;
        }

        input[type="text"].incorrect {
            border-color: #f44336;
            background: #ffebee;
        }

        .check-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .check-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .show-answer-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .show-answer-btn:hover {
            background: #f57c00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
            }
        }

        .feedback.correct {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            color: #2e7d32;
        }

        .feedback.incorrect {
            background: #ffebee;
            border-left: 4px solid #f44336;
            color: #c62828;
        }

        .feedback.hint {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            color: #e65100;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4caf50 0%, #8bc34a 100%);
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .score-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            margin: 20px 0;
        }

        .score-display h3 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .score-display .score {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .reset-btn {
            background: #9c27b0;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
        }

        .reset-btn:hover {
            background: #7b1fa2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(156, 39, 176, 0.3);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .navigation {
                padding: 15px;
            }
            
            .nav-btn {
                padding: 8px 15px;
                font-size: 0.9em;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Lesson 5 Grammar Quiz</h1>
            <p>가정법 과거 & 의문사+to부정사</p>
        </div>

        <div class="navigation">
            <button class="nav-btn active" onclick="showSection('grammar')">문법 정리</button>
            <button class="nav-btn" onclick="showSection('checkup')">Check Up</button>
            <button class="nav-btn" onclick="showSection('level1')">Level 1</button>
            <button class="nav-btn" onclick="showSection('level2')">Level 2</button>
            <button class="nav-btn" onclick="showSection('score')">점수 확인</button>
        </div>

        <div class="content">
            <!-- Grammar Section -->
            <div id="grammar" class="section active">
                <div class="grammar-box">
                    <h3>A. 가정법 과거 (Past Subjunctive)</h3>
                    <ul>
                        <li><strong>형태:</strong> If + 주어 + were/동사의 과거형 ~, 주어 + 조동사의 과거형(would/should/could/might) + 동사원형</li>
                        <li><strong>의미:</strong> "만약 ~한다면, ...할 텐데" - 현재 사실과 반대되는 가정을 나타냄</li>
                    </ul>
                    <div class="example">
                        <strong>예문:</strong><br>
                        If I were a bird, I would fly. (내가 새라면, 나는 날아오를 텐데.)<br>
                        If she had a flying carpet, she could travel all over the world. (그녀가 날아다니는 양탄자를 가지고 있다면, 전 세계를 여행할 수 있을 텐데.)
                    </div>
                </div>

                <div class="grammar-box">
                    <h3>B. 의문사+to부정사 (Question Word + to-infinitive)</h3>
                    <ul>
                        <li><strong>when + to + 동사원형:</strong> 언제 ~할지</li>
                        <li><strong>how + to + 동사원형:</strong> 어떻게 ~할지, ~하는 방법</li>
                        <li><strong>where + to + 동사원형:</strong> 어디서 ~할지</li>
                        <li><strong>what + to + 동사원형:</strong> 무엇을 ~할지</li>
                    </ul>
                    <div class="example">
                        <strong>예문:</strong><br>
                        We didn't know how to read music. (우리는 어떻게 악보를 읽는지 몰랐다.)<br>
                        I told him when to feed the dog. (나는 언제 개에게 먹이를 줄지 그에게 말했다.)
                    </div>
                </div>
            </div>

            <!-- Check Up Section -->
            <div id="checkup" class="section">
                <h2>Check Up - 기본 문법 확인</h2>
                
                <h3>A. 가정법 과거 - 동사 형태</h3>
                <div class="question">
                    <div class="question-header">
                        <div class="question-number">1</div>
                        <div class="question-text">If it _____, I would put on the boots.</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="checkup-a-1" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('checkup-a-1', 'rained')">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('checkup-a-1', 'rained')">답 보기</button>
                    <div id="feedback-checkup-a-1" class="feedback"></div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number">2</div>
                        <div class="question-text">If I _____ a magic lamp, I would make three wishes.</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="checkup-a-2" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('checkup-a-2', 'had')">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('checkup-a-2', 'had')">답 보기</button>
                    <div id="feedback-checkup-a-2" class="feedback"></div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number">3</div>
                        <div class="question-text">If he _____ a policeman, he would help people.</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="checkup-a-3" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('checkup-a-3', 'were')">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('checkup-a-3', 'were')">답 보기</button>
                    <div id="feedback-checkup-a-3" class="feedback"></div>
                </div>

                <h3>B. 의문사+to부정사</h3>
                <div class="question">
                    <div class="question-header">
                        <div class="question-number">1</div>
                        <div class="question-text">I don't know _____ _____ _____ next. (무엇을 해야 할지)</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="checkup-b-1" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('checkup-b-1', 'what to do')">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('checkup-b-1', 'what to do')">답 보기</button>
                    <div id="feedback-checkup-b-1" class="feedback"></div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number">2</div>
                        <div class="question-text">Have you decided _____ _____ _____ for your vacation? (어디로 가야 할지)</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="checkup-b-2" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('checkup-b-2', 'where to go')">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('checkup-b-2', 'where to go')">답 보기</button>
                    <div id="feedback-checkup-b-2" class="feedback"></div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number">3</div>
                        <div class="question-text">He taught us _____ _____ _____ the machine. (어떻게 사용해야 할지)</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="checkup-b-3" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('checkup-b-3', 'how to use')">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('checkup-b-3', 'how to use')">답 보기</button>
                    <div id="feedback-checkup-b-3" class="feedback"></div>
                </div>
            </div>

            <!-- Level 1 Section -->
            <div id="level1" class="section">
                <h2>Level 1 - 문장 완성하기</h2>
                
                <h3>A. 가정법 과거 문장 완성</h3>
                <div class="question">
                    <div class="question-header">
                        <div class="question-number">1</div>
                        <div class="question-text">만약 내가 왕이라면, 나는 사람들에게 선물을 줄 텐데.<br>
                        → If I _____ a king, I _____ _____ people presents.</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="level1-a-1" placeholder="답을 입력하세요 (예: were, would give)">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('level1-a-1', 'were, would give', true)">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('level1-a-1', 'were, would give')">답 보기</button>
                    <div id="feedback-level1-a-1" class="feedback"></div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number">2</div>
                        <div class="question-text">만약 눈이 많이 내린다면, 나는 산에서 스키를 탈 텐데.<br>
                        → If it _____ a lot, I _____ _____ in the mountains.</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="level1-a-2" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('level1-a-2', 'snowed, would ski', true)">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('level1-a-2', 'snowed, would ski')">답 보기</button>
                    <div id="feedback-level1-a-2" class="feedback"></div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number">3</div>
                        <div class="question-text">만약 그가 열심히 공부한다면, 시험에 합격할 수 있을 텐데.<br>
                        → If he _____ hard, he _____ _____ the exam.</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="level1-a-3" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('level1-a-3', 'studied, could pass', true)">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('level1-a-3', 'studied, could pass')">답 보기</button>
                    <div id="feedback-level1-a-3" class="feedback"></div>
                </div>

                <h3>B. 의문사+to부정사 문장 완성</h3>
                <div class="question">
                    <div class="question-header">
                        <div class="question-number">1</div>
                        <div class="question-text">What should I do next? Dad, please tell me _____. (do)</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="level1-b-1" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswerMultiple('level1-b-1', ['what to do', 'what I should do'])">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('level1-b-1', 'what to do / what I should do')">답 보기</button>
                    <div id="feedback-level1-b-1" class="feedback"></div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number">2</div>
                        <div class="question-text">He's still in Seoul. He hasn't decided _____ for America. (leave)</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="level1-b-2" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswerMultiple('level1-b-2', ['when to leave', 'when he should leave'])">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('level1-b-2', 'when to leave / when he should leave')">답 보기</button>
                    <div id="feedback-level1-b-2" class="feedback"></div>
                </div>
            </div>

            <!-- Level 2 Section -->
            <div id="level2" class="section">
                <h2>Level 2 - 가정법 문장 작성 & 문장 변환</h2>
                
                <h3>A. 가정법 문장 작성</h3>
                <div class="question">
                    <div class="question-header">
                        <div class="question-number">1</div>
                        <div class="question-text">그가 피곤하지 않다면, 나와 함께 쇼핑을 갈 수 있을 텐데.<br>
                        → _____</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="level2-a-1" placeholder="전체 문장을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('level2-a-1', 'If he weren\'t tired, he could go shopping with me.', false, true)">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('level2-a-1', 'If he weren\'t tired, he could go shopping with me.')">답 보기</button>
                    <div id="feedback-level2-a-1" class="feedback"></div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number">2</div>
                        <div class="question-text">내가 유명하다면, 내가 가장 좋아하는 영화배우와 사진을 찍을 텐데.<br>
                        → _____</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="level2-a-2" placeholder="전체 문장을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('level2-a-2', 'If I were famous, I would take photos with my favorite movie star.', false, true)">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('level2-a-2', 'If I were famous, I would take photos with my favorite movie star.')">답 보기</button>
                    <div id="feedback-level2-a-2" class="feedback"></div>
                </div>

                <h3>B. 문장 변환 (의문사+to부정사)</h3>
                <div class="question">
                    <div class="question-header">
                        <div class="question-number">1</div>
                        <div class="question-text">I don't know what I should do.<br>
                        = I don't know _____.</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="level2-b-1" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('level2-b-1', 'what to do')">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('level2-b-1', 'what to do')">답 보기</button>
                    <div id="feedback-level2-b-1" class="feedback"></div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number">2</div>
                        <div class="question-text">They didn't decide when they should leave for the station.<br>
                        = They didn't decide _____.</div>
                    </div>
                    <div class="input-container">
                        <input type="text" id="level2-b-2" placeholder="답을 입력하세요">
                    </div>
                    <button class="check-btn" onclick="checkAnswer('level2-b-2', 'when to leave for the station')">정답 확인</button>
                    <button class="show-answer-btn" onclick="showAnswer('level2-b-2', 'when to leave for the station')">답 보기</button>
                    <div id="feedback-level2-b-2" class="feedback"></div>
                </div>
            </div>

            <!-- Score Section -->
            <div id="score" class="section">
                <h2>학습 진행 상황</h2>
                <div class="score-display">
                    <h3>현재 점수</h3>
                    <div class="score">
                        <span id="correct-count">0</span> / <span id="total-count">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <p id="score-percentage">정답률: 0%</p>
                </div>
                <button class="reset-btn" onclick="resetQuiz()">퀴즈 초기화</button>
            </div>
        </div>
    </div>

    <script>
        let correctAnswers = 0;
        let totalAnswered = 0;
        let answeredQuestions = new Set();

        // Sound effects using Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playCorrectSound() {
            // Create a pleasant "ding" sound for correct answers
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator1.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
            oscillator2.frequency.setValueAtTime(659.25, audioContext.currentTime); // E5
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator1.start(audioContext.currentTime);
            oscillator2.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + 0.5);
            oscillator2.stop(audioContext.currentTime + 0.5);
            
            // Add a second "ding" for emphasis
            setTimeout(() => {
                const osc3 = audioContext.createOscillator();
                const gain2 = audioContext.createGain();
                
                osc3.connect(gain2);
                gain2.connect(audioContext.destination);
                
                osc3.frequency.setValueAtTime(783.99, audioContext.currentTime); // G5
                gain2.gain.setValueAtTime(0.2, audioContext.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                osc3.start(audioContext.currentTime);
                osc3.stop(audioContext.currentTime + 0.3);
            }, 100);
        }

        function playIncorrectSound() {
            // Create a gentle "buzz" sound for incorrect answers
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
            
            // Add a second lower tone
            setTimeout(() => {
                const osc2 = audioContext.createOscillator();
                const gain2 = audioContext.createGain();
                
                osc2.connect(gain2);
                gain2.connect(audioContext.destination);
                
                osc2.type = 'sine';
                osc2.frequency.setValueAtTime(80, audioContext.currentTime);
                
                gain2.gain.setValueAtTime(0.15, audioContext.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                
                osc2.start(audioContext.currentTime);
                osc2.stop(audioContext.currentTime + 0.15);
            }, 50);
        }

        function playHintSound() {
            // Create a soft "whoosh" sound for hints
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sine';
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(1000, audioContext.currentTime);
            filter.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.3);
            
            oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.3);
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // Initialize audio context on first user interaction
        let audioInitialized = false;
        function initAudio() {
            if (!audioInitialized && audioContext.state === 'suspended') {
                audioContext.resume();
                audioInitialized = true;
            }
        }

        function showSection(sectionId) {
            initAudio();
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function normalizeAnswer(answer) {
            // Remove extra spaces and convert to lowercase
            return answer.toLowerCase().replace(/\s+/g, ' ').trim();
        }

        function checkAnswer(inputId, correctAnswer, allowPartial = false, isFullSentence = false) {
            const input = document.getElementById(inputId);
            const userAnswer = normalizeAnswer(input.value);
            const normalized = normalizeAnswer(correctAnswer);
            const feedback = document.getElementById(`feedback-${inputId}`);
            
            // Track if this question was already answered
            const wasAnswered = answeredQuestions.has(inputId);
            
            let isCorrect = false;
            
            if (allowPartial) {
                // For multiple-part answers (comma-separated)
                const userParts = userAnswer.split(',').map(s => s.trim());
                const correctParts = normalized.split(',').map(s => s.trim());
                isCorrect = userParts.length === correctParts.length && 
                           userParts.every((part, i) => part === correctParts[i]);
            } else if (isFullSentence) {
                // For full sentences, be more lenient with punctuation
                const userClean = userAnswer.replace(/[.,!?]/g, '');
                const correctClean = normalized.replace(/[.,!?]/g, '');
                isCorrect = userClean === correctClean;
            } else {
                isCorrect = userAnswer === normalized;
            }
            
            if (isCorrect) {
                input.classList.remove('incorrect');
                input.classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.innerHTML = '✅ 정답입니다! 훌륭해요!';
                feedback.style.display = 'block';
                playCorrectSound(); // Play success sound
                
                if (!wasAnswered) {
                    correctAnswers++;
                    totalAnswered++;
                    answeredQuestions.add(inputId);
                    updateScore();
                }
            } else {
                input.classList.remove('correct');
                input.classList.add('incorrect');
                feedback.className = 'feedback incorrect';
                playIncorrectSound(); // Play error sound
                
                // Provide specific feedback based on the question type
                let errorMessage = '❌ 틀렸습니다. ';
                
                if (inputId.includes('checkup-a')) {
                    errorMessage += '가정법 과거에서는 동사의 과거형을 사용합니다. be동사는 주어와 관계없이 "were"를 사용할 수 있습니다.';
                } else if (inputId.includes('checkup-b') || inputId.includes('level1-b')) {
                    errorMessage += '의문사 + to + 동사원형 형태를 확인해보세요.';
                } else if (inputId.includes('level1-a')) {
                    errorMessage += '가정법 과거 구조를 확인하세요: If + 주어 + 과거형, 주어 + would/could + 동사원형';
                } else if (inputId.includes('level2-a')) {
                    errorMessage += '가정법 과거 문장 구조와 동사 형태를 다시 확인해보세요.';
                } else if (inputId.includes('level2-b')) {
                    errorMessage += '의문사절을 의문사+to부정사로 축약하는 방법을 다시 확인해보세요.';
                }
                
                feedback.innerHTML = errorMessage;
                feedback.style.display = 'block';
                
                if (!wasAnswered) {
                    totalAnswered++;
                    answeredQuestions.add(inputId);
                    updateScore();
                }
            }
        }

        function checkAnswerMultiple(inputId, correctAnswers) {
            const input = document.getElementById(inputId);
            const userAnswer = normalizeAnswer(input.value);
            const feedback = document.getElementById(`feedback-${inputId}`);
            
            // Track if this question was already answered
            const wasAnswered = answeredQuestions.has(inputId);
            
            const isCorrect = correctAnswers.some(answer => 
                normalizeAnswer(answer) === userAnswer
            );
            
            if (isCorrect) {
                input.classList.remove('incorrect');
                input.classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.innerHTML = '✅ 정답입니다! 두 가지 형태 모두 가능합니다.';
                feedback.style.display = 'block';
                playCorrectSound(); // Play success sound
                
                if (!wasAnswered) {
                    correctAnswers++;
                    totalAnswered++;
                    answeredQuestions.add(inputId);
                    updateScore();
                }
            } else {
                input.classList.remove('correct');
                input.classList.add('incorrect');
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = '❌ 틀렸습니다. 의문사+to부정사 또는 의문사+주어+should+동사원형 형태를 사용할 수 있습니다.';
                feedback.style.display = 'block';
                playIncorrectSound(); // Play error sound
                
                if (!wasAnswered) {
                    totalAnswered++;
                    answeredQuestions.add(inputId);
                    updateScore();
                }
            }
        }

        function showAnswer(inputId, answer) {
            const feedback = document.getElementById(`feedback-${inputId}`);
            feedback.className = 'feedback hint';
            feedback.innerHTML = `💡 정답: ${answer}`;
            feedback.style.display = 'block';
            playHintSound(); // Play hint sound
        }

        function updateScore() {
            document.getElementById('correct-count').textContent = correctAnswers;
            document.getElementById('total-count').textContent = totalAnswered;
            
            const percentage = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;
            document.getElementById('score-percentage').textContent = `정답률: ${percentage}%`;
            document.getElementById('progress-fill').style.width = `${percentage}%`;
        }

        function resetQuiz() {
            if (!confirm('정말로 퀴즈를 초기화하시겠습니까? 모든 답안과 점수가 초기화됩니다.')) {
                return;
            }
            
            // Reset all inputs
            document.querySelectorAll('input[type="text"]').forEach(input => {
                input.value = '';
                input.classList.remove('correct', 'incorrect');
            });
            
            // Hide all feedback
            document.querySelectorAll('.feedback').forEach(feedback => {
                feedback.style.display = 'none';
            });
            
            // Reset scores
            correctAnswers = 0;
            totalAnswered = 0;
            answeredQuestions.clear();
            updateScore();
            
            // Go back to grammar section
            showSection('grammar');
            document.querySelector('.nav-btn').classList.add('active');
        }

        // Add enter key support for inputs and initialize audio
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize audio on first interaction
            document.addEventListener('click', initAudio, { once: true });
            document.addEventListener('keydown', initAudio, { once: true });
            
            document.querySelectorAll('input[type="text"]').forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const checkBtn = this.parentElement.nextElementSibling;
                        if (checkBtn && checkBtn.classList.contains('check-btn')) {
                            checkBtn.click();
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>